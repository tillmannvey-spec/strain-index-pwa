<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#11150f">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Can Strain Index">
  <meta name="format-detection" content="telephone=no">
  <title>Strain Index</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon-180.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Sora:wght@500;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="app">
    <header class="header">
      <h1>STRAIN<span>INDEX</span></h1>
      <button type="button" id="quickAddBtn" class="add-btn" aria-label="Neuer Eintrag">
        <span class="material-symbols-outlined">add</span>
      </button>
    </header>

    <div class="controls">
      <div class="search-row">
        <input id="searchInput" type="search" placeholder="Suchen…">
        <button type="button" id="toggleFilterBtn" class="icon-btn" aria-label="Filter" aria-expanded="false">
          <span class="material-symbols-outlined">tune</span>
        </button>
      </div>
      <div id="filterPanel" class="filter-panel" hidden>
        <select id="manufacturerFilter"></select>
        <select id="effectFilter"></select>
        <select id="medicalFilter"></select>
      </div>
    </div>

    <div class="grid-header">
      <span id="strainCount" class="count">0 Strains</span>
    </div>

    <div id="strainGrid" class="grid"></div>
  </div>

  <!-- Detail Overlay -->
  <dialog id="detailDialog" class="detail-dialog">
    <div class="detail-inner">
      <header class="detail-bar">
        <button type="button" class="close-btn" data-close-dialog aria-label="Schliessen">
          <span class="material-symbols-outlined">close</span>
        </button>
      </header>
      <div id="detailContent" class="detail-content"></div>
    </div>
  </dialog>

  <dialog id="quickActionsDialog" class="modal compact-modal">
    <div class="modal-form">
      <header class="modal-header">
        <h2>Neuer Eintrag</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <button type="button" class="ghost-btn" id="quickResearchBtn">Research</button>
      <button type="button" class="primary-btn" id="quickImportBtn">Strain importieren</button>
      <button type="button" class="ghost-btn" id="quickCreateBtn">Strain eingeben</button>
    </div>
  </dialog>

  <dialog id="researchDialog" class="modal">
    <form id="researchForm" class="modal-form">
      <header class="modal-header">
        <h2>Strain Research</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <label>Strains (ein Name pro Zeile oder komma-separiert)
        <textarea id="researchInput" rows="8" placeholder="Blue Dream&#10;Pink Kush"></textarea>
      </label>
      <p id="researchStatus" class="status-line"></p>
      <footer class="modal-footer">
        <button type="button" class="ghost-btn" data-close-dialog>Abbrechen</button>
        <button type="submit" class="primary-btn">Research starten</button>
      </footer>
    </form>
  </dialog>

  <dialog id="researchReviewDialog" class="modal">
    <form id="researchReviewForm" class="modal-form">
      <header class="modal-header">
        <h2>Research Ergebnisse</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <p class="status-line">Waehle aus, welche Strains angelegt werden sollen.</p>
      <div id="researchReviewList" class="research-list"></div>
      <footer class="modal-footer">
        <button type="button" class="ghost-btn" data-close-dialog>Abbrechen</button>
        <button type="submit" class="primary-btn">Ausgewaehlte hinzufuegen</button>
      </footer>
    </form>
  </dialog>

  <dialog id="strainDialog" class="modal">
    <form id="strainForm" class="modal-form">
      <header class="modal-header">
        <h2>Strain-Profil</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <div class="field-grid">
        <label>Name<input required name="name" type="text"></label>
        <label>Hersteller<input name="manufacturer" type="text"></label>
        <label>Genetik<input name="genetics" type="text"></label>
        <label>THC<input name="thc" type="text" placeholder="z.B. 22%"></label>
        <label>CBD<input name="cbd" type="text" placeholder="z.B. 0.7%"></label>
        <label class="full">Anbau<input name="cultivation" type="text" placeholder="z.B. unbestrahlt, Kanada"></label>
        <label class="full">Wirkungsprofil<textarea data-autogrow name="effects" rows="2" placeholder="Euphorisch, Kreativ"></textarea></label>
        <label class="full">Geschmack/Aroma<textarea data-autogrow name="aromaFlavor" rows="2" placeholder="Beere, Erde"></textarea></label>
        <label class="full">Gesamtwirkung<textarea data-autogrow name="overallEffect" rows="3"></textarea></label>
        <label class="full">Onset & Dauer<textarea data-autogrow name="onsetDuration" rows="2" placeholder="Onset 8 min / Dauer 3 h"></textarea></label>
        <label class="full">Characteristic<textarea data-autogrow name="characteristic" rows="3"></textarea></label>
        <label class="full">Medizinische Anwendungen<textarea data-autogrow name="medicalApplications" rows="3" placeholder="Schmerz, Stress"></textarea></label>
        <label class="full">Community-Feedback<textarea data-autogrow name="communityFeedback" rows="4"></textarea></label>
        <label class="full">Notizen<textarea data-autogrow name="notes" rows="4"></textarea></label>
      </div>

      <section class="terpene-section">
        <h3>Terpenprofil</h3>
        <div id="terpeneRows" class="terpene-rows"></div>
        <button type="button" class="ghost-btn small" id="addTerpeneBtn">Terpen hinzufuegen</button>
      </section>

      <section class="image-section">
        <label>Profilbild
          <input id="imageInput" type="file" accept="image/*">
          <input id="imageValue" type="hidden">
        </label>
        <img id="imagePreview" class="preview hidden" alt="Vorschau Profilbild">
      </section>

      <footer class="modal-footer">
        <button type="button" class="ghost-btn" data-close-dialog>Abbrechen</button>
        <button type="submit" class="primary-btn">Profil speichern</button>
      </footer>
    </form>
  </dialog>

  <dialog id="importDialog" class="modal">
    <form id="importForm" class="modal-form">
      <header class="modal-header">
        <h2>Strain importieren</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <label>Import-Text
        <textarea id="importText" name="importText" rows="14" placeholder="Freitext oder strukturierter Text..."></textarea>
      </label>

      <details class="settings-box">
        <summary>Import-Einstellungen</summary>
        <label class="checkbox-row">
          <input type="checkbox" id="settingsUseLlm">
          <span>Gemini fuer automatische Zuordnung nutzen</span>
        </label>
        <label>API Key<input id="settingsApiKey" type="password" placeholder="AIza..."></label>
        <label>Model<input id="settingsModel" type="text" placeholder="gemini-3-flash-preview"></label>
        <label>Endpoint<input id="settingsEndpoint" type="url" placeholder="https://generativelanguage.googleapis.com/v1beta"></label>
        <button type="button" class="ghost-btn small" id="saveSettingsBtn">Import-Einstellungen speichern</button>
      </details>
      <p id="importStatus" class="status-line"></p>

      <footer class="modal-footer">
        <button type="button" class="ghost-btn" data-close-dialog>Abbrechen</button>
        <button type="submit" class="primary-btn">Text analysieren</button>
      </footer>
    </form>
  </dialog>

  <dialog id="importReviewDialog" class="modal">
    <div class="modal-form">
      <header class="modal-header">
        <h2>Import prüfen</h2>
        <button type="button" class="ghost-btn small" data-close-dialog>Schliessen</button>
      </header>
      <p id="importReviewSource" class="status-line"></p>
      <div id="importReviewContent" class="import-review-grid"></div>
      <footer class="modal-footer">
        <button type="button" class="ghost-btn" data-close-dialog>Abbrechen</button>
        <button type="button" id="importReviewEditBtn" class="primary-btn">In Editor übernehmen</button>
      </footer>
    </div>
  </dialog>

  <script type="module" src="./src/app.js"></script>
</body>
</html>
